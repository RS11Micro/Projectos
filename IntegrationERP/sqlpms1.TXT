 select ##VendasProtel2987.ID_InternoDoc, sum(##VendasProtel2987.ValorLiquido) as ValorLiquido,sum(##VendasProtel2987.Valor) as Total, sum(##VendasProtel2987.ValorIva) as ValorIva, ##VendasProtel2987.ID_TipoDocumento as ID_TipodocumentoProtel,TiposDocumentosVnd.ContaCbl as ContaCblTipoDocumento, ##VendasProtel2987.ID_documento,##VendasProtel2987.ID_CodigoCliente, ##VendasProtel2987.dataDoc, ##VendasProtel2987.dataVencimento,tiposDocumentosVnd.Pms_Tipodoc as DescTipodoc, ContasLancamentoVnd.ContaCBLFamilia  ,ContasLancamentoVnd.ContaCBLIVA , ContasLancamentoVnd.ClasseIVA ,ContasLancamentoVnd.ContaCCusto,ContasLancamentoVnd.ContaAnalitica   ,ContasLancamentoVnd.ContaCBLFamiliaNCperIVAdifFACT  ,ContasLancamentoVnd.ContaCBLIVANCperIVAdifFACT ,ContasLancamentoVnd.ClasseIVANCperIVAdifFACT  ,ContasLancamentoVnd.ContaCCustoNCperIVAdifFACT, ContasLancamentoVnd.ContaAnaliticaNCperIVAdifFACT    ,##VendasProtel2987.Descricaoartigo,##VendasProtel2987.DescricaoIVA,##VendasProtel2987.descricaodoc, TiposDocumentosVnd.natureza,TiposDocumentosVnd.NaturezaNeg,TiposDocumentosVnd.NaturezaPag, TiposDocumentosVnd.NaturezaPagNeg, ##VendasProtel2987.tipomovimento,##VendasProtel2987.nomecliente, CBL_ModoPagamentoPMS.contaCbl as  ContaCBLPagamento,##VendasProtel2987.TipoMovimento,##VendasProtel2987.id_modoPagamento, ##VendasProtel2987.contacblCliente,##VendasProtel2987.id_hotel,##VendasProtel2987.Ncontribuinte,##VendasProtel2987.mercado ,##VendasProtel2987.DocTotalZERO , ##VendasProtel2987.Nomecliente,##VendasProtel2987.Morada,##VendasProtel2987.Localidade,##VendasProtel2987.CodigoPostal,##VendasProtel2987.Telefone, ##VendasProtel2987.NcForaPerIVA from ##VendasProtel2987 inner join CBL_TipoDocPMS As TiposDocumentosVnd on TiposDocumentosVnd.Pms_Id_Tipodoc=##VendasProtel2987.ID_TipoDocumento Left join CBL_contaFamiliaPMS as ContasLancamentoVnd on ContasLancamentoVnd.PMS_ID_ContaFamilia=##VendasProtel2987.ID_contaLanc and ContasLancamentoVnd.PMS_ID_TipoDoc=##VendasProtel2987.ID_TipoDocumento and ContasLancamentoVnd.mercado=##VendasProtel2987.mercado and ContasLancamentoVnd.Pms_Id_Tipodoc= TiposDocumentosVnd.Pms_Id_Tipodoc Left join CBL_ModoPagamentoPMS  on CBL_ModoPagamentoPMS.PMS_ID_ModoPagamento=##VendasProtel2987.ID_ModoPagamento and  CBL_ModoPagamentoPMS.id_Hotel=##VendasProtel2987.id_Hotel  where ##VendasProtel2987.ID_Hotel IN(1) Group By naturezatipodoc,##VendasProtel2987.ID_InternoDoc,##VendasProtel2987.ID_TipoDocumento,TiposDocumentosVnd.ContaCbl , ##VendasProtel2987.ID_documento,##VendasProtel2987.ID_CodigoCliente, ##VendasProtel2987.dataDoc,##VendasProtel2987.dataVencimento,tiposDocumentosVnd.Pms_Tipodoc , ContasLancamentoVnd.ContaCBLFamilia,ContasLancamentoVnd.ContaCBLIVA,ContasLancamentoVnd.ClasseIVA,  ##VendasProtel2987.Descricaoartigo,##VendasProtel2987.DescricaoIVA,##VendasProtel2987.descricaodoc, TiposDocumentosVnd.natureza,TiposDocumentosVnd.NaturezaNeg,TiposDocumentosVnd.NaturezaPag, TiposDocumentosVnd.NaturezaPagNeg , ##VendasProtel2987.tipomovimento,##VendasProtel2987.nomecliente,CBL_ModoPagamentoPMS.contaCbl, ##VendasProtel2987.id_modoPagamento,  ##VendasProtel2987.contacblCliente,##VendasProtel2987.id_hotel,##VendasProtel2987.Ncontribuinte ,##VendasProtel2987.Mercado,##VendasProtel2987.DocTotalZERO, ContasLancamentoVnd.ContaCCusto,ContasLancamentoVnd.ContaAnalitica, ##VendasProtel2987.Nomecliente,##VendasProtel2987.Morada,##VendasProtel2987.Localidade,##VendasProtel2987.CodigoPostal,##VendasProtel2987.Telefone ,ContasLancamentoVnd.ContaCBLFamiliaNCperIVAdifFACT  ,ContasLancamentoVnd.ContaCBLIVANCperIVAdifFACT ,ContasLancamentoVnd.ClasseIVANCperIVAdifFACT  ,ContasLancamentoVnd.ContaCCustoNCperIVAdifFACT,  ContasLancamentoVnd.ContaAnaliticaNCperIVAdifFACT ,NcForaPerIVA  order by ##VendasProtel2987.ID_InternoDoc,##VendasProtel2987.datadoc,  ##VendasProtel2987.ID_TipoDocumento ,##VendasProtel2987.ID_documento,##VendasProtel2987.tipomovimento,##VendasProtel2987.nomecliente, TiposDocumentosVnd.ContaCbl,##VendasProtel2987.descricaodoc, ##VendasProtel2987.contacblCliente,##VendasProtel2987.id_hotel,##VendasProtel2987.Ncontribuinte,##VendasProtel2987.Mercado, ContasLancamentoVnd.ContaCCusto,ContasLancamentoVnd.ContaAnalitica
